"use strict";(()=>{var e={};e.id=426,e.ids=[426],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},665:e=>{e.exports=require("dns")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},2694:e=>{e.exports=require("http2")},8216:e=>{e.exports=require("net")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},5816:e=>{e.exports=require("process")},6162:e=>{e.exports=require("stream")},2452:e=>{e.exports=require("tls")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},3353:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>A,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>c,POST:()=>d});var s=r(9303),n=r(8716),o=r(670),i=r(7070),l=r(8629),u=r(9419);async function c(e){try{let t;console.log("\uD83D\uDD0D Alumni API: Starting request...");let{searchParams:r}=new URL(e.url),a=r.get("strand")??void 0,s=r.get("q")?.toLowerCase()??"";console.log("\uD83D\uDD0D Alumni API: Query params -",{strand:a,searchQuery:s});let n=(0,l.hJ)(u.db,"alumni");try{a?(t=(0,l.IO)(n,(0,l.ar)("strand","==",a),(0,l.ar)("status","==","approved")),console.log("\uD83D\uDD0D Alumni API: Using strand filter + approved status")):(t=(0,l.IO)(n,(0,l.ar)("status","==","approved")),console.log("\uD83D\uDD0D Alumni API: Using approved status filter only")),console.log("\uD83D\uDD0D Alumni API: Executing Firestore query...");let e=await (0,l.PL)(t),r=[];return e.forEach(e=>{let t=e.data();r.push({id:e.id,name:t.name,strand:t.strand,collegeCourse:t.collegeCourse,currentOccupation:t.currentOccupation,credentialsInField:t.credentialsInField||"",email:t.email||"",status:t.status||"approved",createdAt:t.createdAt,updatedAt:t.updatedAt})}),r.sort((e,t)=>e.createdAt&&t.createdAt&&"seconds"in e.createdAt&&"seconds"in t.createdAt?t.createdAt.seconds-e.createdAt.seconds:0),console.log(`✅ Alumni API: Found ${r.length} records`),s&&(r=r.filter(e=>`${e.name} ${e.strand} ${e.collegeCourse} ${e.currentOccupation} ${e.credentialsInField}`.toLowerCase().includes(s)),console.log(`✅ Alumni API: After search filter: ${r.length} records`)),i.NextResponse.json(r)}catch(e){if("failed-precondition"===e.code||e.message?.includes("index")){console.warn("⚠️ Alumni API: Firestore index required. Attempting fallback...");try{let e=await (0,l.PL)(n),t=[];return e.forEach(e=>{let r=e.data();"approved"===r.status&&t.push({id:e.id,name:r.name,strand:r.strand,collegeCourse:r.collegeCourse,currentOccupation:r.currentOccupation,credentialsInField:r.credentialsInField||"",email:r.email||"",status:r.status||"approved",createdAt:r.createdAt,updatedAt:r.updatedAt})}),a&&(t=t.filter(e=>e.strand===a)),t.sort((e,t)=>e.createdAt&&t.createdAt&&"seconds"in e.createdAt&&"seconds"in t.createdAt?t.createdAt.seconds-e.createdAt.seconds:0),s&&(t=t.filter(e=>`${e.name} ${e.strand} ${e.collegeCourse} ${e.currentOccupation} ${e.credentialsInField}`.toLowerCase().includes(s))),console.log(`✅ Alumni API (Fallback): Found ${t.length} records`),i.NextResponse.json(t)}catch(e){throw console.error("❌ Fallback query also failed:",e),e}}throw e}}catch(e){return console.error("❌ Alumni API Error:",{message:e.message,code:e.code,stack:e.stack?.split("\n").slice(0,3)}),i.NextResponse.json({error:"Failed to read alumni data",details:e.message,code:e.code},{status:500})}}async function d(e){try{let{name:t,strand:r,collegeCourse:a,currentOccupation:s,credentialsInField:n}=await e.json();if(!t||!r||!a||!s)return i.NextResponse.json({error:"Name, strand, college course, and current occupation are required"},{status:400});let o=(0,l.hJ)(u.db,"alumni"),c=(0,l.IO)(o,(0,l.ar)("name","==",t),(0,l.ar)("strand","==",r));if(!(await (0,l.PL)(c)).empty)return i.NextResponse.json({error:"An alumni with this name and strand already exists"},{status:409});let d={name:t,strand:r,collegeCourse:a,currentOccupation:s,credentialsInField:n||"",status:"pending",createdAt:(0,l.Bt)(),updatedAt:(0,l.Bt)()},p={id:(await (0,l.ET)(o,d)).id,...d};return i.NextResponse.json({message:"Alumni registration submitted successfully! Your registration is pending approval by the school registrar.",alumni:p,status:"pending"},{status:201})}catch(e){return console.error("Error registering alumni:",e),i.NextResponse.json({error:"Failed to register alumni. Please try again."},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/alumni/route",pathname:"/api/alumni",filename:"route",bundlePath:"app/api/alumni/route"},resolvedPagePath:"C:\\Users\\adestajo\\Desktop\\REPO\\New folder\\Alumni Tracking Website\\src\\app\\api\\alumni\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:A}=p,h="/api/alumni/route";function f(){return(0,o.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:g})}},9419:(e,t,r)=>{let a;r.d(t,{db:()=>i});var s=r(9362),n=r(8629);let o={apiKey:"AIzaSyAm0MdHaVr6cVA147cwMQiCL7wvpB1c1Ho",authDomain:"scihi-alumni-tracking.firebaseapp.com",projectId:"scihi-alumni-tracking",storageBucket:"scihi-alumni-tracking.firebasestorage.app",messagingSenderId:"776095020338",appId:"1:776095020338:web:77e44b70e46d77203e932b"};try{(function(){let e=["apiKey","authDomain","projectId","appId"].filter(e=>!o[e]);if(e.length>0)throw console.error("❌ Firebase configuration is incomplete. Missing:",e),console.error("Make sure you have a .env.local file with all NEXT_PUBLIC_FIREBASE_* variables"),Error(`Firebase configuration missing: ${e.join(", ")}`)})(),a=0===(0,s.C6)().length?(0,s.ZF)(o):(0,s.Mq)(),console.log("✅ Firebase initialized successfully for project:",o.projectId)}catch(e){throw console.error("❌ Firebase initialization failed:",e),e}let i=(0,n.ad)(a)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972,960],()=>r(3353));module.exports=a})();